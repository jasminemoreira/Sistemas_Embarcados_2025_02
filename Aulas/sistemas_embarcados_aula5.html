<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aula 5 - Laborat√≥rio Integrativo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            padding: 20px;
            color: #1d1d1f;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .title {
            font-size: 3rem;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 1.3rem;
            color: #666;
            font-weight: 400;
            margin-bottom: 30px;
        }

        .section {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border-left: 6px solid #667eea;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.1);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .section:hover {
            transform: translateY(-5px);
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .section-icon {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .section-title {
            color: #667eea;
            font-size: 1.8rem;
            font-weight: 600;
            margin: 0;
        }

        .explanation-box {
            background: #f8f9fa;
            border-left: 4px solid #28a745;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.6;
        }

        .explanation-box h4 {
            color: #28a745;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 25px;
            border-radius: 12px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            line-height: 1.6;
            overflow-x: auto;
            margin: 20px 0;
            border-left: 4px solid #667eea;
            position: relative;
        }

        .code-header {
            background: #2d2d2d;
            color: #ffffff;
            padding: 10px 20px;
            margin: -25px -25px 15px -25px;
            border-radius: 12px 12px 0 0;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .copy-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 6px 14px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            outline: none;
            user-select: none;
        }

        .copy-button:hover {
            background: #5a67d8;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .highlight-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 16px;
            margin: 25px 0;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .highlight-box h4 {
            font-size: 1.4rem;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .circuit-box {
            background: linear-gradient(135deg, #ffc107, #ff9800);
            color: #333;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            font-weight: 500;
        }

        .circuit-box h4 {
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .syntax-keyword { color: #569cd6; }
        .syntax-string { color: #ce9178; }
        .syntax-comment { color: #6a9955; }
        .syntax-number { color: #b5cea8; }
        .syntax-function { color: #dcdcaa; }
        .syntax-type { color: #4ec9b0; }
        .syntax-define { color: #c586c0; }
        .syntax-operator { color: #d4d4d4; font-weight: bold; }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 25px;
                margin: 10px;
            }

            .title {
                font-size: 2.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="badge">üéØ Aula 5 - 27/08 - Laborat√≥rio Integrativo</div>
            <h1 class="title">Registradores e Operadores Bit-a-Bit</h1>
            <p class="subtitle">Manipula√ß√£o direta de hardware + Ponteiros + Controle via Serial</p>
        </div>

        <div class="highlight-box">
            <h4>üéØ Objetivos da Aula</h4>
            <p>Dominar a manipula√ß√£o direta de registradores usando operadores bit-a-bit, compreender ponteiros para acesso √† mem√≥ria, e implementar controle avan√ßado via comunica√ß√£o serial com o Arduino Mega.</p>
        </div>

        <div class="circuit-box">
            <h4>üîß Circuito Necess√°rio</h4>
            <p><strong>LEDs:</strong> 8 LEDs nos pinos 22-29 (PORTA A) com resistores 220Œ©</p>
            <p><strong>Push-buttons:</strong> 4 bot√µes nos pinos 30-33 (pull-up interno) </p>
            <p><strong>Potenci√¥metro:</strong> No pino A0 para teste de ADC</p>
            <p><strong>Serial:</strong> Conex√£o USB para comunica√ß√£o</p>
        </div>

        <!-- Atividade 1: Manipula√ß√£o de Registradores -->
        <div class="section">
            <div class="section-header">
                <div class="section-icon">‚öôÔ∏è</div>
                <h2 class="section-title">Atividade 1: Controle Direto de Registradores</h2>
            </div>

            <div class="explanation-box">
                <h4>üìö O que este c√≥digo faz:</h4>
                <p><strong>Objetivo:</strong> Demonstrar manipula√ß√£o direta dos registradores PORTA do Arduino Mega.</p>
                <p><strong>Conceitos:</strong> Registradores DDR (dire√ß√£o), PORT (sa√≠da), PIN (entrada), manipula√ß√£o bit-a-bit.</p>
                <p><strong>Aprendizado:</strong> Diferen√ßa entre digitalWrite() e acesso direto aos registradores (muito mais r√°pido!).</p>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span>‚öôÔ∏è controle_registradores.ino</span>
                    <button class="copy-button" onclick="copyCode(this)">Copiar</button>
                </div>
<pre><code><span class="syntax-comment">/*
 * Manipula√ß√£o Direta de Registradores - Arduino Mega
 * Demonstra operadores bit-a-bit e acesso direto ao hardware
 * LEDs: Pinos 22-29 (PORTA A)
 * Bot√µes: Pinos 30-33 (PORTA C, com pull-up)
 */</span>

<span class="syntax-comment">// Defini√ß√µes para facilitar leitura</span>
<span class="syntax-define">#define</span> <span class="syntax-function">LED_PORT</span>     <span class="syntax-function">PORTA</span>    <span class="syntax-comment">// Registrador de sa√≠da</span>
<span class="syntax-define">#define</span> <span class="syntax-function">LED_DDR</span>      <span class="syntax-function">DDRA</span>     <span class="syntax-comment">// Registrador de dire√ß√£o</span>
<span class="syntax-define">#define</span> <span class="syntax-function">BUTTON_PORT</span>  <span class="syntax-function">PORTC</span>    <span class="syntax-comment">// Pull-ups dos bot√µes</span>
<span class="syntax-define">#define</span> <span class="syntax-function">BUTTON_DDR</span>   <span class="syntax-function">DDRC</span>     <span class="syntax-comment">// Dire√ß√£o dos bot√µes</span>
<span class="syntax-define">#define</span> <span class="syntax-function">BUTTON_PIN</span>   <span class="syntax-function">PINC</span>     <span class="syntax-comment">// Leitura dos bot√µes</span>

<span class="syntax-comment">// M√°scaras para opera√ß√µes bit-a-bit</span>
<span class="syntax-define">#define</span> <span class="syntax-function">TODOS_LEDS</span>   <span class="syntax-number">0xFF</span>     <span class="syntax-comment">// 11111111 - todos os 8 bits</span>
<span class="syntax-define">#define</span> <span class="syntax-function">BOTAO_0</span>      <span class="syntax-number">0x01</span>     <span class="syntax-comment">// 00000001 - bit 0</span>
<span class="syntax-define">#define</span> <span class="syntax-function">BOTAO_1</span>      <span class="syntax-number">0x02</span>     <span class="syntax-comment">// 00000010 - bit 1</span>
<span class="syntax-define">#define</span> <span class="syntax-function">BOTAO_2</span>      <span class="syntax-number">0x04</span>     <span class="syntax-comment">// 00000100 - bit 2</span>
<span class="syntax-define">#define</span> <span class="syntax-function">BOTAO_3</span>      <span class="syntax-number">0x08</span>     <span class="syntax-comment">// 00001000 - bit 3</span>

<span class="syntax-type">uint8_t</span> padrao_atual = <span class="syntax-number">0x00</span>;
<span class="syntax-type">uint8_t</span> velocidade = <span class="syntax-number">100</span>;
<span class="syntax-type">bool</span> modo_automatico = <span class="syntax-keyword">false</span>;

<span class="syntax-type">void</span> <span class="syntax-function">setup</span>() {
  <span class="syntax-function">Serial</span>.<span class="syntax-function">begin</span>(<span class="syntax-number">115200</span>);
  
  <span class="syntax-comment">// Configurar LEDs como sa√≠da (PORTA)</span>
  <span class="syntax-function">LED_DDR</span> = <span class="syntax-function">TODOS_LEDS</span>; <span class="syntax-comment">// Todos os pinos como sa√≠da</span>
  <span class="syntax-function">LED_PORT</span> = <span class="syntax-number">0x00</span>;        <span class="syntax-comment">// Todos os LEDs desligados</span>
  
  <span class="syntax-comment">// Configurar bot√µes como entrada com pull-up (PORTC bits 0-3)</span>
  <span class="syntax-function">BUTTON_DDR</span> <span class="syntax-operator">&=</span> <span class="syntax-operator">~</span>(<span class="syntax-function">BOTAO_0</span> <span class="syntax-operator">|</span> <span class="syntax-function">BOTAO_1</span> <span class="syntax-operator">|</span> <span class="syntax-function">BOTAO_2</span> <span class="syntax-operator">|</span> <span class="syntax-function">BOTAO_3</span>); <span class="syntax-comment">// Entrada</span>
  <span class="syntax-function">BUTTON_PORT</span> <span class="syntax-operator">|=</span> (<span class="syntax-function">BOTAO_0</span> <span class="syntax-operator">|</span> <span class="syntax-function">BOTAO_1</span> <span class="syntax-operator">|</span> <span class="syntax-function">BOTAO_2</span> <span class="syntax-operator">|</span> <span class="syntax-function">BOTAO_3</span>); <span class="syntax-comment">// Pull-up</span>
  
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"=== CONTROLE DE REGISTRADORES ==="</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"Comandos via Serial:"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"- SET:0xFF   -> Define padr√£o (hex)"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"- SHIFT:L    -> Desloca esquerda"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"- SHIFT:R    -> Desloca direita"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"- AUTO:ON/OFF -> Modo autom√°tico"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"- SPEED:100  -> Velocidade (ms)"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"- REGS       -> Status registradores"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>();
  
  <span class="syntax-comment">// Teste inicial dos LEDs</span>
  <span class="syntax-function">testeInicial</span>();
}

<span class="syntax-type">void</span> <span class="syntax-function">testeInicial</span>() {
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"Teste dos LEDs..."</span>);
  
  <span class="syntax-comment">// Acender um LED por vez</span>
  <span class="syntax-keyword">for</span> (<span class="syntax-type">int</span> i = <span class="syntax-number">0</span>; i < <span class="syntax-number">8</span>; i++) {
    <span class="syntax-function">LED_PORT</span> = <span class="syntax-number">1</span> <span class="syntax-operator"><<</span> i; <span class="syntax-comment">// Deslocamento bit-a-bit</span>
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">"LED "</span>);
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(i);
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">" - Registro: 0x"</span>);
    <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-function">LED_PORT</span>, <span class="syntax-function">HEX</span>);
    <span class="syntax-function">delay</span>(<span class="syntax-number">200</span>);
  }
  
  <span class="syntax-function">LED_PORT</span> = <span class="syntax-number">0x00</span>; <span class="syntax-comment">// Apagar todos</span>
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"Teste conclu√≠do. Sistema pronto!"</span>);
}

<span class="syntax-type">void</span> <span class="syntax-function">loop</span>() {
  <span class="syntax-comment">// Processar comandos seriais</span>
  <span class="syntax-keyword">if</span> (<span class="syntax-function">Serial</span>.<span class="syntax-function">available</span>()) {
    <span class="syntax-function">processarComando</span>();
  }
  
  <span class="syntax-comment">// Verificar bot√µes f√≠sicos</span>
  <span class="syntax-function">verificarBotoes</span>();
  
  <span class="syntax-comment">// Modo autom√°tico</span>
  <span class="syntax-keyword">if</span> (modo_automatico) {
    <span class="syntax-type">static unsigned long</span> ultimo_shift = <span class="syntax-number">0</span>;
    <span class="syntax-keyword">if</span> (<span class="syntax-function">millis</span>() - ultimo_shift >= velocidade) {
      <span class="syntax-function">rotacionarEsquerda</span>();
      ultimo_shift = <span class="syntax-function">millis</span>();
    }
  }
  
  <span class="syntax-comment">// Atualizar LEDs</span>
  <span class="syntax-function">LED_PORT</span> = padrao_atual;
}

<span class="syntax-type">void</span> <span class="syntax-function">verificarBotoes</span>() {
  <span class="syntax-type">static uint8_t</span> botoes_anterior = <span class="syntax-number">0xFF</span>;
  <span class="syntax-type">uint8_t</span> botoes_atual = <span class="syntax-function">BUTTON_PIN</span>; <span class="syntax-comment">// Leitura direta do registrador</span>
  
  <span class="syntax-comment">// Detectar bot√µes pressionados (transi√ß√£o 1->0)</span>
  <span class="syntax-type">uint8_t</span> botoes_pressionados = botoes_anterior <span class="syntax-operator">&</span> <span class="syntax-operator">~</span>botoes_atual;
  
  <span class="syntax-keyword">if</span> (botoes_pressionados <span class="syntax-operator">&</span> <span class="syntax-function">BOTAO_0</span>) {
    <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"üî¥ Bot√£o 0: Rota√ß√£o esquerda"</span>);
    <span class="syntax-function">rotacionarEsquerda</span>();
  }
  
  <span class="syntax-keyword">if</span> (botoes_pressionados <span class="syntax-operator">&</span> <span class="syntax-function">BOTAO_1</span>) {
    <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"üü° Bot√£o 1: Rota√ß√£o direita"</span>);
    <span class="syntax-function">rotacionarDireita</span>();
  }
  
  <span class="syntax-keyword">if</span> (botoes_pressionados <span class="syntax-operator">&</span> <span class="syntax-function">BOTAO_2</span>) {
    <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"üü¢ Bot√£o 2: Inverter padr√£o"</span>);
    padrao_atual = <span class="syntax-operator">~</span>padrao_atual; <span class="syntax-comment">// Operador NOT bit-a-bit</span>
  }
  
  <span class="syntax-keyword">if</span> (botoes_pressionados <span class="syntax-operator">&</span> <span class="syntax-function">BOTAO_3</span>) {
    <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"üîµ Bot√£o 3: Padr√£o aleat√≥rio"</span>);
    padrao_atual = <span class="syntax-function">random</span>(<span class="syntax-number">0</span>, <span class="syntax-number">256</span>);
  }
  
  botoes_anterior = botoes_atual;
}

<span class="syntax-type">void</span> <span class="syntax-function">rotacionarEsquerda</span>() {
  <span class="syntax-comment">// Salvar bit mais significativo</span>
  <span class="syntax-type">uint8_t</span> bit_msb = padrao_atual <span class="syntax-operator">&</span> <span class="syntax-number">0x80</span>; <span class="syntax-comment">// M√°scara 10000000</span>
  
  <span class="syntax-comment">// Deslocar esquerda e adicionar MSB na posi√ß√£o 0</span>
  padrao_atual = (padrao_atual <span class="syntax-operator"><<</span> <span class="syntax-number">1</span>) <span class="syntax-operator">|</span> (bit_msb ? <span class="syntax-number">1</span> : <span class="syntax-number">0</span>);
  
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">"‚¨ÖÔ∏è Rota√ß√£o esquerda: 0x"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(padrao_atual, <span class="syntax-function">HEX</span>);
}

<span class="syntax-type">void</span> <span class="syntax-function">rotacionarDireita</span>() {
  <span class="syntax-comment">// Salvar bit menos significativo</span>
  <span class="syntax-type">uint8_t</span> bit_lsb = padrao_atual <span class="syntax-operator">&</span> <span class="syntax-number">0x01</span>; <span class="syntax-comment">// M√°scara 00000001</span>
  
  <span class="syntax-comment">// Deslocar direita e adicionar LSB na posi√ß√£o 7</span>
  padrao_atual = (padrao_atual <span class="syntax-operator">>></span> <span class="syntax-number">1</span>) <span class="syntax-operator">|</span> (bit_lsb ? <span class="syntax-number">0x80</span> : <span class="syntax-number">0x00</span>);
  
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">"‚û°Ô∏è Rota√ß√£o direita: 0x"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(padrao_atual, <span class="syntax-function">HEX</span>);
}

<span class="syntax-type">void</span> <span class="syntax-function">processarComando</span>() {
  <span class="syntax-type">String</span> comando = <span class="syntax-function">Serial</span>.<span class="syntax-function">readString</span>();
  comando.<span class="syntax-function">trim</span>();
  comando.<span class="syntax-function">toUpperCase</span>();
  
  <span class="syntax-keyword">if</span> (comando.<span class="syntax-function">startsWith</span>(<span class="syntax-string">"SET:"</span>)) {
    <span class="syntax-type">String</span> valor = comando.<span class="syntax-function">substring</span>(<span class="syntax-number">4</span>);
    padrao_atual = <span class="syntax-function">strtol</span>(valor.<span class="syntax-function">c_str</span>(), <span class="syntax-function">NULL</span>, <span class="syntax-number">16</span>);
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">"‚úÖ Padr√£o definido: 0x"</span>);
    <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(padrao_atual, <span class="syntax-function">HEX</span>);
    
  } <span class="syntax-keyword">else if</span> (comando == <span class="syntax-string">"SHIFT:L"</span>) {
    <span class="syntax-function">rotacionarEsquerda</span>();
    
  } <span class="syntax-keyword">else if</span> (comando == <span class="syntax-string">"SHIFT:R"</span>) {
    <span class="syntax-function">rotacionarDireita</span>();
    
  } <span class="syntax-keyword">else if</span> (comando == <span class="syntax-string">"AUTO:ON"</span>) {
    modo_automatico = <span class="syntax-keyword">true</span>;
    <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"üîÑ Modo autom√°tico ativado"</span>);
    
  } <span class="syntax-keyword">else if</span> (comando == <span class="syntax-string">"AUTO:OFF"</span>) {
    modo_automatico = <span class="syntax-keyword">false</span>;
    <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"‚èπÔ∏è Modo autom√°tico desativado"</span>);
    
  } <span class="syntax-keyword">else if</span> (comando.<span class="syntax-function">startsWith</span>(<span class="syntax-string">"SPEED:"</span>)) {
    velocidade = comando.<span class="syntax-function">substring</span>(<span class="syntax-number">6</span>).<span class="syntax-function">toInt</span>();
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">"‚ö° Velocidade: "</span>);
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(velocidade);
    <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"ms"</span>);
    
  } <span class="syntax-keyword">else if</span> (comando == <span class="syntax-string">"REGS"</span>) {
    <span class="syntax-function">mostrarRegistradores</span>();
    
  } <span class="syntax-keyword">else</span> {
    <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"‚ùå Comando inv√°lido"</span>);
  }
}

<span class="syntax-type">void</span> <span class="syntax-function">mostrarRegistradores</span>() {
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"--- STATUS DOS REGISTRADORES ---"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">"DDRA  (dire√ß√£o LEDs): 0x"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-function">DDRA</span>, <span class="syntax-function">HEX</span>);
  
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">"PORTA (sa√≠da LEDs):   0x"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-function">PORTA</span>, <span class="syntax-function">HEX</span>);
  
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">"DDRC  (dire√ß√£o BTN):  0x"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-function">DDRC</span>, <span class="syntax-function">HEX</span>);
  
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">"PINC  (leitura BTN):  0x"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-function">PINC</span>, <span class="syntax-function">HEX</span>);
  
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"Padr√£o atual em bin√°rio:"</span>);
  <span class="syntax-keyword">for</span> (<span class="syntax-type">int</span> i = <span class="syntax-number">7</span>; i >= <span class="syntax-number">0</span>; i--) {
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>((padrao_atual >> i) <span class="syntax-operator">&</span> <span class="syntax-number">1</span>);
  }
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>();
}</code></pre>
            </div>
        </div>

        <!-- Atividade 2: Ponteiros e Mem√≥ria -->
        <div class="section">
            <div class="section-header">
                <div class="section-icon">üß†</div>
                <h2 class="section-title">Atividade 2: Ponteiros e Acesso √† Mem√≥ria</h2>
            </div>

            <div class="explanation-box">
                <h4>üìö O que este c√≥digo faz:</h4>
                <p><strong>Objetivo:</strong> Demonstrar uso de ponteiros para acessar mem√≥ria e registradores diretamente.</p>
                <p><strong>Conceitos:</strong> Ponteiros, dereferenciamento, aritm√©tica de ponteiros, volatile.</p>
                <p><strong>Aplica√ß√£o:</strong> Mapeamento de mem√≥ria para controle de hardware, otimiza√ß√£o de performance.</p>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span>üß† ponteiros_memoria.ino</span>
                    <button class="copy-button" onclick="copyCode(this)">Copiar</button>
                </div>
<pre><code><span class="syntax-comment">/*
 * Demonstra√ß√£o de Ponteiros e Acesso √† Mem√≥ria
 * Arduino Mega - Manipula√ß√£o via ponteiros
 */</span>

<span class="syntax-comment">// Ponteiros para registradores (endere√ßos fixos na mem√≥ria)</span>
<span class="syntax-type">volatile uint8_t</span>* <span class="syntax-keyword">const</span> led_ddr = &<span class="syntax-function">DDRA</span>;    <span class="syntax-comment">// Dire√ß√£o PORTA</span>
<span class="syntax-type">volatile uint8_t</span>* <span class="syntax-keyword">const</span> led_port = &<span class="syntax-function">PORTA</span>;  <span class="syntax-comment">// Sa√≠da PORTA</span>
<span class="syntax-type">volatile uint8_t</span>* <span class="syntax-keyword">const</span> adc_reg = &<span class="syntax-function">ADCH</span>;   <span class="syntax-comment">// ADC high byte</span>

<span class="syntax-comment">// Buffer para demonstra√ß√£o de aritm√©tica de ponteiros</span>
<span class="syntax-type">uint8_t</span> buffer[<span class="syntax-number">16</span>] = {<span class="syntax-number">0</span>};
<span class="syntax-type">uint8_t</span>* ptr_buffer = buffer;

<span class="syntax-comment">// Estrutura para organiza√ßao de dados</span>
<span class="syntax-keyword">typedef struct</span> {
  <span class="syntax-type">uint16_t</span> endereco;
  <span class="syntax-type">uint8_t</span> valor;
  <span class="syntax-type">char</span> nome[<span class="syntax-number">10</span>];
} <span class="syntax-type">registro_t</span>;

<span class="syntax-type">registro_t</span> registros[<span class="syntax-number">4</span>];
<span class="syntax-type">registro_t</span>* ptr_regs = registros;

<span class="syntax-type">void</span> <span class="syntax-function">setup</span>() {
  <span class="syntax-function">Serial</span>.<span class="syntax-function">begin</span>(<span class="syntax-number">115200</span>);
  
  <span class="syntax-comment">// Configurar ADC para leitura do potenci√¥metro</span>
  <span class="syntax-function">ADMUX</span> = <span class="syntax-number">0x60</span>;   <span class="syntax-comment">// AVCC reference, canal 0, left adjusted</span>
  <span class="syntax-function">ADCSRA</span> = <span class="syntax-number">0x87</span>; <span class="syntax-comment">// ADC enable, prescaler 128</span>
  
  <span class="syntax-comment">// Configurar LEDs via ponteiro</span>
  *led_ddr = <span class="syntax-number">0xFF</span>;  <span class="syntax-comment">// Todos como sa√≠da</span>
  *led_port = <span class="syntax-number">0x00</span>; <span class="syntax-comment">// Todos desligados</span>
  
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"=== PONTEIROS E MEMORIA ==="</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"Comandos:"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"- MEM        -> Info de mem√≥ria"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"- BUFFER:XX  -> Preencher buffer (hex)"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"- DUMP       -> Mostrar buffer"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"- REGS       -> Info registradores"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"- ADC        -> Ler potenci√¥metro"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>();
  
  <span class="syntax-comment">// Inicializar estrutura de registradores</span>
  <span class="syntax-function">inicializarRegistros</span>();
  
  <span class="syntax-comment">// Demonstrar endere√ßos de mem√≥ria</span>
  <span class="syntax-function">mostrarEnderecos</span>();
}

<span class="syntax-type">void</span> <span class="syntax-function">inicializarRegistros</span>() {
  <span class="syntax-comment">// Usar aritm√©tica de ponteiros para preencher estruturas</span>
  (ptr_regs + <span class="syntax-number">0</span>)->endereco = (<span class="syntax-type">uint16_t</span>)&<span class="syntax-function">DDRA</span>;
  <span class="syntax-function">strcpy</span>((ptr_regs + <span class="syntax-number">0</span>)->nome, <span class="syntax-string">"DDRA"</span>);
  
  (ptr_regs + <span class="syntax-number">1</span>)->endereco = (<span class="syntax-type">uint16_t</span>)&<span class="syntax-function">PORTA</span>;
  <span class="syntax-function">strcpy</span>((ptr_regs + <span class="syntax-number">1</span>)->nome, <span class="syntax-string">"PORTA"</span>);
  
  (ptr_regs + <span class="syntax-number">2</span>)->endereco = (<span class="syntax-type">uint16_t</span>)&<span class="syntax-function">ADMUX</span>;
  <span class="syntax-function">strcpy</span>((ptr_regs + <span class="syntax-number">2</span>)->nome, <span class="syntax-string">"ADMUX"</span>);
  
  (ptr_regs + <span class="syntax-number">3</span>)->endereco = (<span class="syntax-type">uint16_t</span>)&<span class="syntax-function">ADCSRA</span>;
  <span class="syntax-function">strcpy</span>((ptr_regs + <span class="syntax-number">3</span>)->nome, <span class="syntax-string">"ADCSRA"</span>);
}

<span class="syntax-type">void</span> <span class="syntax-function">mostrarEnderecos</span>() {
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"--- ENDERECOS NA MEMORIA ---"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">"üìç Buffer[16]:     0x"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>((<span class="syntax-type">uint16_t</span>)buffer, <span class="syntax-function">HEX</span>);
  
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">"üìç Registros[4]:  0x"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>((<span class="syntax-type">uint16_t</span>)registros, <span class="syntax-function">HEX</span>);
  
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">"üìç DDRA:          0x"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>((<span class="syntax-type">uint16_t</span>)&<span class="syntax-function">DDRA</span>, <span class="syntax-function">HEX</span>);
  
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">"üìç PORTA:         0x"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>((<span class="syntax-type">uint16_t</span>)&<span class="syntax-function">PORTA</span>, <span class="syntax-function">HEX</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>();
}

<span class="syntax-type">void</span> <span class="syntax-function">loop</span>() {
  <span class="syntax-comment">// Processar comandos</span>
  <span class="syntax-keyword">if</span> (<span class="syntax-function">Serial</span>.<span class="syntax-function">available</span>()) {
    <span class="syntax-function">processarComandoPonteiros</span>();
  }
  
  <span class="syntax-comment">// Mostrar valor do ADC nos LEDs via ponteiros</span>
  <span class="syntax-type">static unsigned long</span> ultimo_adc = <span class="syntax-number">0</span>;
  <span class="syntax-keyword">if</span> (<span class="syntax-function">millis</span>() - ultimo_adc >= <span class="syntax-number">100</span>) {
    <span class="syntax-function">lerADCviaponteiro</span>();
    ultimo_adc = <span class="syntax-function">millis</span>();
  }
}

<span class="syntax-type">void</span> <span class="syntax-function">lerADCviaponteiro</span>() {
  <span class="syntax-comment">// Iniciar convers√£o</span>
  <span class="syntax-function">ADCSRA</span> |= (<span class="syntax-number">1</span> << <span class="syntax-function">ADSC</span>);
  
  <span class="syntax-comment">// Aguardar conclus√£o</span>
  <span class="syntax-keyword">while</span> (<span class="syntax-function">ADCSRA</span> & (<span class="syntax-number">1</span> << <span class="syntax-function">ADSC</span>));
  
  <span class="syntax-comment">// Ler resultado via ponteiro</span>
  <span class="syntax-type">uint8_t</span> valor_adc = *adc_reg;
  
  <span class="syntax-comment">// Mostrar nos LEDs via ponteiro</span>
  *led_port = valor_adc;
}

<span class="syntax-type">void</span> <span class="syntax-function">processarComandoPonteiros</span>() {
  <span class="syntax-type">String</span> comando = <span class="syntax-function">Serial</span>.<span class="syntax-function">readString</span>();
  comando.<span class="syntax-function">trim</span>();
  comando.<span class="syntax-function">toUpperCase</span>();
  
  <span class="syntax-keyword">if</span> (comando == <span class="syntax-string">"MEM"</span>) {
    <span class="syntax-function">mostrarInfoMemoria</span>();
    
  } <span class="syntax-keyword">else if</span> (comando.<span class="syntax-function">startsWith</span>(<span class="syntax-string">"BUFFER:"</span>)) {
    <span class="syntax-type">String</span> valor = comando.<span class="syntax-function">substring</span>(<span class="syntax-number">7</span>);
    <span class="syntax-function">preencherBuffer</span>(<span class="syntax-function">strtol</span>(valor.<span class="syntax-function">c_str</span>(), <span class="syntax-function">NULL</span>, <span class="syntax-number">16</span>));
    
  } <span class="syntax-keyword">else if</span> (comando == <span class="syntax-string">"DUMP"</span>) {
    <span class="syntax-function">mostrarBuffer</span>();
    
  } <span class="syntax-keyword">else if</span> (comando == <span class="syntax-string">"REGS"</span>) {
    <span class="syntax-function">mostrarRegistrosviaponteiro</span>();
    
  } <span class="syntax-keyword">else if</span> (comando == <span class="syntax-string">"ADC"</span>) {
    <span class="syntax-function">lerEMostrarADC</span>();
    
  } <span class="syntax-keyword">else</span> {
    <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"‚ùå Comando inv√°lido"</span>);
  }
}

<span class="syntax-type">void</span> <span class="syntax-function">preencherBuffer</span>(<span class="syntax-type">uint8_t</span> padrao) {
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">"üîÑ Preenchendo buffer com: 0x"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(padrao, <span class="syntax-function">HEX</span>);
  
  <span class="syntax-comment">// Usar aritm√©tica de ponteiros</span>
  <span class="syntax-keyword">for</span> (<span class="syntax-type">int</span> i = <span class="syntax-number">0</span>; i < <span class="syntax-number">16</span>; i++) {
    *(ptr_buffer + i) = padrao + i; <span class="syntax-comment">// Incrementar valor</span>
  }
  
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"‚úÖ Buffer preenchido!"</span>);
}

<span class="syntax-type">void</span> <span class="syntax-function">mostrarBuffer</span>() {
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"--- DUMP DO BUFFER ---"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">"Endere√ßo base: 0x"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>((<span class="syntax-type">uint16_t</span>)ptr_buffer, <span class="syntax-function">HEX</span>);
  
  <span class="syntax-keyword">for</span> (<span class="syntax-type">int</span> i = <span class="syntax-number">0</span>; i < <span class="syntax-number">16</span>; i++) {
    <span class="syntax-keyword">if</span> (i % <span class="syntax-number">8</span> == <span class="syntax-number">0</span>) {
      <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">"\n0x"</span>);
      <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>((<span class="syntax-type">uint16_t</span>)(ptr_buffer + i), <span class="syntax-function">HEX</span>);
      <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">": "</span>);
    }
    
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">"0x"</span>);
    <span class="syntax-keyword">if</span> (*(ptr_buffer + i) < <span class="syntax-number">0x10</span>) <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">"0"</span>);
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(*(ptr_buffer + i), <span class="syntax-function">HEX</span>);
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">" "</span>);
  }
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>();
}

<span class="syntax-type">void</span> <span class="syntax-function">mostrarRegistrosviaponteiro</span>() {
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"--- REGISTRADORES VIA PONTEIROS ---"</span>);
  
  <span class="syntax-keyword">for</span> (<span class="syntax-type">int</span> i = <span class="syntax-number">0</span>; i < <span class="syntax-number">4</span>; i++) {
    <span class="syntax-type">registro_t</span>* reg = ptr_regs + i; <span class="syntax-comment">// Aritm√©tica de ponteiros</span>
    reg->valor = *(<span class="syntax-type">volatile uint8_t</span>*)(reg->endereco); <span class="syntax-comment">// Ler via ponteiro</span>
    
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(reg->nome);
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">" (0x"</span>);
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(reg->endereco, <span class="syntax-function">HEX</span>);
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">"): 0x"</span>);
    <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(reg->valor, <span class="syntax-function">HEX</span>);
  }
}

<span class="syntax-type">void</span> <span class="syntax-function">lerEMostrarADC</span>() {
  <span class="syntax-comment">// For√ßar leitura do ADC</span>
  <span class="syntax-function">ADCSRA</span> |= (<span class="syntax-number">1</span> << <span class="syntax-function">ADSC</span>);
  <span class="syntax-keyword">while</span> (<span class="syntax-function">ADCSRA</span> & (<span class="syntax-number">1</span> << <span class="syntax-function">ADSC</span>));
  
  <span class="syntax-type">uint8_t</span> valor = *adc_reg;
  <span class="syntax-type">float</span> tensao = (valor / <span class="syntax-number">255.0</span>) * <span class="syntax-number">5.0</span>;
  
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">"üî¨ ADC via ponteiro: 0x"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(valor, <span class="syntax-function">HEX</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">" ("</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(tensao, <span class="syntax-number">2</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"V)"</span>);
  
  <span class="syntax-comment">// Mostrar nos LEDs</span>
  *led_port = valor;
}

<span class="syntax-type">void</span> <span class="syntax-function">mostrarInfoMemoria</span>() {
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">"--- INFORMA√á√ïES DE MEM√ìRIA ---"</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">"üß† Tamanho de ponteiro: "</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-keyword">sizeof</span>(<span class="syntax-type">void</span>*));
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">" bytes"</span>);
  
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">"üìä Estrutura registro_t: "</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-keyword">sizeof</span>(<span class="syntax-type">registro_t</span>));
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">" bytes"</span>);
  
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">"üì¶ Buffer[16]: "</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-keyword">sizeof</span>(buffer));
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">" bytes"</span>);
  
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">"üéØ Diferen√ßa de endere√ßos: "</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-keyword">sizeof</span>(<span class="syntax-type">uint8_t</span>) * (<span class="syntax-number">8</span> - <span class="syntax-number">1</span>));
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">" bytes entre buffer[0] e buffer[7]"</span>);
}</code></pre>
            </div>
        </div>

        <!-- Atividade 3: Console de Comandos Avan√ßado -->
        <div class="section">
            <div class="section-header">
                <div class="section-icon">üíª</div>
                <h2 class="section-title">Atividade 3: Console Integrado de Comandos</h2>
            </div>

            <div class="explanation-box">
                <h4>üìö O que este c√≥digo faz:</h4>
                <p><strong>Objetivo:</strong> Sistema completo de comandos seriais integrando registradores, ponteiros e opera√ß√µes bit-a-bit.</p>
                <p><strong>Conceitos:</strong> Menu interativo, processamento avan√ßado de strings, sistema de comandos robusto.</p>
                <p><strong>Integra√ß√£o:</strong> Une todas as atividades anteriores em uma interface unificada via Serial.</p>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span>üíª console_integrado.ino</span>
                    <button class="copy-button" onclick="copyCode(this)">Copiar</button>
                </div>
<pre><code><span class="syntax-comment">/*
 * Console Integrado de Comandos - Sistema Completo
 * Integra controle de registradores, ponteiros e opera√ß√µes bit-a-bit
 */</span>

<span class="syntax-comment">// Defini√ß√µes para interface mais amig√°vel</span>
<span class="syntax-define">#define</span> <span class="syntax-function">CMD_BUFFER_SIZE</span> <span class="syntax-number">64</span>
<span class="syntax-define">#define</span> <span class="syntax-function">MAX_ARGS</span>        <span class="syntax-number">4</span>

<span class="syntax-comment">// Estrutura para comandos</span>
<span class="syntax-keyword">typedef struct</span> {
  <span class="syntax-type">char</span> nome[<span class="syntax-number">16</span>];
  <span class="syntax-type">char</span> descricao[<span class="syntax-number">64</span>];
  <span class="syntax-type">void</span> (*funcao)(<span class="syntax-type">char</span>* args[], <span class="syntax-type">int</span> argc);
} <span class="syntax-type">comando_t</span>;

<span class="syntax-comment">// Buffer para processamento de comandos</span>
<span class="syntax-type">char</span> cmd_buffer[<span class="syntax-function">CMD_BUFFER_SIZE</span>];
<span class="syntax-type">int</span> cmd_pos = <span class="syntax-number">0</span>;

<span class="syntax-comment">// Vari√°veis globais do sistema</span>
<span class="syntax-type">bool</span> modo_debug = <span class="syntax-keyword">false</span>;
<span class="syntax-type">uint8_t</span> valor_padrao = <span class="syntax-number">0xAA</span>;

<span class="syntax-comment">// Declara√ß√µes de fun√ß√µes dos comandos</span>
<span class="syntax-type">void</span> <span class="syntax-function">cmd_help</span>(<span class="syntax-type">char</span>* args[], <span class="syntax-type">int</span> argc);
<span class="syntax-type">void</span> <span class="syntax-function">cmd_set_led</span>(<span class="syntax-type">char</span>* args[], <span class="syntax-type">int</span> argc);
<span class="syntax-type">void</span> <span class="syntax-function">cmd_bit_op</span>(<span class="syntax-type">char</span>* args[], <span class="syntax-type">int</span> argc);
<span class="syntax-type">void</span> <span class="syntax-function">cmd_mem_dump</span>(<span class="syntax-type">char</span>* args[], <span class="syntax-type">int</span> argc);
<span class="syntax-type">void</span> <span class="syntax-function">cmd_reg_info</span>(<span class="syntax-type">char</span>* args[], <span class="syntax-type">int</span> argc);
<span class="syntax-type">void</span> <span class="syntax-function">cmd_debug</span>(<span class="syntax-type">char</span>* args[], <span class="syntax-type">int</span> argc);
<span class="syntax-type">void</span> <span class="syntax-function">cmd_benchmark</span>(<span class="syntax-type">char</span>* args[], <span class="syntax-type">int</span> argc);

<span class="syntax-comment">// Tabela de comandos</span>
<span class="syntax-type">comando_t</span> comandos[] = {
  {<span class="syntax-string">"help"</span>, <span class="syntax-string">"Mostra lista de comandos"</span>, cmd_help},
  {<span class="syntax-string">"led"</span>, <span class="syntax-string">"led <valor_hex> - Controla LEDs"</span>, cmd_set_led},
  {<span class="syntax-string">"bit"</span>, <span class="syntax-string">"bit <op> <val> - Opera√ß√µes bit-a-bit (and/or/xor/not)"</span>, cmd_bit_op},
  {<span class="syntax-string">"dump"</span>, <span class="syntax-string">"dump <end> <tam> - Mostra conte√∫do da mem√≥ria"</span>, cmd_mem_dump},
  {<span class="syntax-string">"regs"</span>, <span class="syntax-string">"Mostra status dos registradores"</span>, cmd_reg_info},
  {<span class="syntax-string">"debug"</span>, <span class="syntax-string">"debug on/off - Liga/desliga modo debug"</span>, cmd_debug},
  {<span class="syntax-string">"bench"</span>, <span class="syntax-string">"Benchmark de opera√ß√µes bit-a-bit"</span>, cmd_benchmark}
};

<span class="syntax-define">#define</span> <span class="syntax-function">NUM_COMANDOS</span> (<span class="syntax-keyword">sizeof</span>(comandos) / <span class="syntax-keyword">sizeof</span>(<span class="syntax-type">comando_t</span>))

<span class="syntax-type">void</span> <span class="syntax-function">setup</span>() {
  <span class="syntax-function">Serial</span>.<span class="syntax-function">begin</span>(<span class="syntax-number">115200</span>);
  
  <span class="syntax-comment">// Configurar hardware</span>
  <span class="syntax-function">DDRA</span> = <span class="syntax-number">0xFF</span>;  <span class="syntax-comment">// LEDs como sa√≠da</span>
  <span class="syntax-function">PORTA</span> = <span class="syntax-number">0x00</span>; <span class="syntax-comment">// LEDs desligados</span>
  
  <span class="syntax-comment">// Banner do sistema</span>
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">F("\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"</span>));
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">F("‚ïë    CONSOLE DE SISTEMA EMBARCADO   ‚ïë"</span>));
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">F("‚ïë         Arduino Mega 2560         ‚ïë"</span>));
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">F("‚ïë  Registradores & Ponteiros v1.0   ‚ïë"</span>));
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">F("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"</span>));
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">F("Digite 'help' para ver comandos dispon√≠veis\n"</span>));
  
  <span class="syntax-comment">// Prompt inicial</span>
  <span class="syntax-function">mostrarPrompt</span>();
}

<span class="syntax-type">void</span> <span class="syntax-function">loop</span>() {
  <span class="syntax-comment">// Processar entrada serial</span>
  <span class="syntax-keyword">while</span> (<span class="syntax-function">Serial</span>.<span class="syntax-function">available</span>()) {
    <span class="syntax-type">char</span> c = <span class="syntax-function">Serial</span>.<span class="syntax-function">read</span>();
    
    <span class="syntax-keyword">if</span> (c == <span class="syntax-string">'\n'</span> || c == <span class="syntax-string">'\r'</span>) {
      <span class="syntax-keyword">if</span> (cmd_pos > <span class="syntax-number">0</span>) {
        cmd_buffer[cmd_pos] = <span class="syntax-string">'\0'</span>;
        <span class="syntax-function">processarComando</span>(cmd_buffer);
        cmd_pos = <span class="syntax-number">0</span>;
      }
      <span class="syntax-function">mostrarPrompt</span>();
      
    } <span class="syntax-keyword">else if</span> (c == <span class="syntax-number">8</span> || c == <span class="syntax-number">127</span>) { <span class="syntax-comment">// Backspace</span>
      <span class="syntax-keyword">if</span> (cmd_pos > <span class="syntax-number">0</span>) {
        cmd_pos--;
        <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F("\b \b"</span>));
      }
      
    } <span class="syntax-keyword">else if</span> (cmd_pos < <span class="syntax-function">CMD_BUFFER_SIZE</span> - <span class="syntax-number">1</span> && c >= <span class="syntax-number">32</span>) {
      cmd_buffer[cmd_pos++] = c;
      <span class="syntax-function">Serial</span>.<span class="syntax-function">write</span>(c); <span class="syntax-comment">// Echo</span>
    }
  }
}

<span class="syntax-type">void</span> <span class="syntax-function">mostrarPrompt</span>() {
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F("arduino> "</span>));
}

<span class="syntax-type">void</span> <span class="syntax-function">processarComando</span>(<span class="syntax-type">char</span>* linha) {
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(); <span class="syntax-comment">// Nova linha</span>
  
  <span class="syntax-comment">// Parsear argumentos</span>
  <span class="syntax-type">char</span>* args[<span class="syntax-function">MAX_ARGS</span>];
  <span class="syntax-type">int</span> argc = <span class="syntax-number">0</span>;
  
  <span class="syntax-type">char</span>* token = <span class="syntax-function">strtok</span>(linha, <span class="syntax-string">" \t"</span>);
  <span class="syntax-keyword">while</span> (token && argc < <span class="syntax-function">MAX_ARGS</span>) {
    args[argc++] = token;
    token = <span class="syntax-function">strtok</span>(<span class="syntax-function">NULL</span>, <span class="syntax-string">" \t"</span>);
  }
  
  <span class="syntax-keyword">if</span> (argc == <span class="syntax-number">0</span>) <span class="syntax-keyword">return</span>;
  
  <span class="syntax-comment">// Buscar e executar comando</span>
  <span class="syntax-keyword">for</span> (<span class="syntax-type">int</span> i = <span class="syntax-number">0</span>; i < <span class="syntax-function">NUM_COMANDOS</span>; i++) {
    <span class="syntax-keyword">if</span> (<span class="syntax-function">strcmp</span>(args[<span class="syntax-number">0</span>], comandos[i].nome) == <span class="syntax-number">0</span>) {
      comandos[i].funcao(args, argc);
      <span class="syntax-keyword">return</span>;
    }
  }
  
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F("‚ùå Comando desconhecido: "</span>));
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(args[<span class="syntax-number">0</span>]);
}

<span class="syntax-comment">// ========== IMPLEMENTA√á√ÉO DOS COMANDOS ==========</span>

<span class="syntax-type">void</span> <span class="syntax-function">cmd_help</span>(<span class="syntax-type">char</span>* args[], <span class="syntax-type">int</span> argc) {
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">F("üìã COMANDOS DISPON√çVEIS:\n"</span>));
  
  <span class="syntax-keyword">for</span> (<span class="syntax-type">int</span> i = <span class="syntax-number">0</span>; i < <span class="syntax-function">NUM_COMANDOS</span>; i++) {
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F("  "</span>));
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(comandos[i].nome);
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F(" - "</span>));
    <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(comandos[i].descricao);
  }
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>();
}

<span class="syntax-type">void</span> <span class="syntax-function">cmd_set_led</span>(<span class="syntax-type">char</span>* args[], <span class="syntax-type">int</span> argc) {
  <span class="syntax-keyword">if</span> (argc < <span class="syntax-number">2</span>) {
    <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">F("‚ùå Uso: led <valor_hex>"</span>));
    <span class="syntax-keyword">return</span>;
  }
  
  <span class="syntax-type">uint8_t</span> valor = <span class="syntax-function">strtol</span>(args[<span class="syntax-number">1</span>], <span class="syntax-function">NULL</span>, <span class="syntax-number">16</span>);
  <span class="syntax-function">PORTA</span> = valor;
  valor_padrao = valor;
  
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F("üí° LEDs definidos para: 0x"</span>));
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(valor, <span class="syntax-function">HEX</span>);
  
  <span class="syntax-keyword">if</span> (modo_debug) {
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F("üîç Bin√°rio: "</span>));
    <span class="syntax-keyword">for</span> (<span class="syntax-type">int</span> i = <span class="syntax-number">7</span>; i >= <span class="syntax-number">0</span>; i--) {
      <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>((valor >> i) & <span class="syntax-number">1</span>);
    }
    <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>();
  }
}

<span class="syntax-type">void</span> <span class="syntax-function">cmd_bit_op</span>(<span class="syntax-type">char</span>* args[], <span class="syntax-type">int</span> argc) {
  <span class="syntax-keyword">if</span> (argc < <span class="syntax-number">3</span>) {
    <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">F("‚ùå Uso: bit <opera√ß√£o> <valor>"</span>));
    <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">F("   Opera√ß√µes: and, or, xor, not"</span>));
    <span class="syntax-keyword">return</span>;
  }
  
  <span class="syntax-type">uint8_t</span> operando = <span class="syntax-function">strtol</span>(args[<span class="syntax-number">2</span>], <span class="syntax-function">NULL</span>, <span class="syntax-number">16</span>);
  <span class="syntax-type">uint8_t</span> resultado;
  
  <span class="syntax-keyword">if</span> (<span class="syntax-function">strcmp</span>(args[<span class="syntax-number">1</span>], <span class="syntax-string">"and"</span>) == <span class="syntax-number">0</span>) {
    resultado = valor_padrao & operando;
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F("üîß 0x"</span>));
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(valor_padrao, <span class="syntax-function">HEX</span>);
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F(" AND 0x"</span>));
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(operando, <span class="syntax-function">HEX</span>);
    
  } <span class="syntax-keyword">else if</span> (<span class="syntax-function">strcmp</span>(args[<span class="syntax-number">1</span>], <span class="syntax-string">"or"</span>) == <span class="syntax-number">0</span>) {
    resultado = valor_padrao | operando;
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F("üîß 0x"</span>));
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(valor_padrao, <span class="syntax-function">HEX</span>);
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F(" OR 0x"</span>));
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(operando, <span class="syntax-function">HEX</span>);
    
  } <span class="syntax-keyword">else if</span> (<span class="syntax-function">strcmp</span>(args[<span class="syntax-number">1</span>], <span class="syntax-string">"xor"</span>) == <span class="syntax-number">0</span>) {
    resultado = valor_padrao ^ operando;
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F("üîß 0x"</span>));
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(valor_padrao, <span class="syntax-function">HEX</span>);
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F(" XOR 0x"</span>));
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(operando, <span class="syntax-function">HEX</span>);
    
  } <span class="syntax-keyword">else if</span> (<span class="syntax-function">strcmp</span>(args[<span class="syntax-number">1</span>], <span class="syntax-string">"not"</span>) == <span class="syntax-number">0</span>) {
    resultado = ~valor_padrao;
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F("üîß NOT 0x"</span>));
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(valor_padrao, <span class="syntax-function">HEX</span>);
    
  } <span class="syntax-keyword">else</span> {
    <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">F("‚ùå Opera√ß√£o inv√°lida"</span>));
    <span class="syntax-keyword">return</span>;
  }
  
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F(" = 0x"</span>));
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(resultado, <span class="syntax-function">HEX</span>);
  
  <span class="syntax-comment">// Atualizar LEDs</span>
  <span class="syntax-function">PORTA</span> = resultado;
  valor_padrao = resultado;
}

<span class="syntax-type">void</span> <span class="syntax-function">cmd_mem_dump</span>(<span class="syntax-type">char</span>* args[], <span class="syntax-type">int</span> argc) {
  <span class="syntax-keyword">if</span> (argc < <span class="syntax-number">3</span>) {
    <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">F("‚ùå Uso: dump <endere√ßo_hex> <tamanho>"</span>));
    <span class="syntax-keyword">return</span>;
  }
  
  <span class="syntax-type">uint16_t</span> endereco = <span class="syntax-function">strtol</span>(args[<span class="syntax-number">1</span>], <span class="syntax-function">NULL</span>, <span class="syntax-number">16</span>);
  <span class="syntax-type">int</span> tamanho = <span class="syntax-function">atoi</span>(args[<span class="syntax-number">2</span>]);
  
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F("üß† Dump da mem√≥ria: 0x"</span>));
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(endereco, <span class="syntax-function">HEX</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F(" ("</span>));
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(tamanho);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">F(" bytes)\n"</span>));
  
  <span class="syntax-type">volatile uint8_t</span>* ptr = (<span class="syntax-type">volatile uint8_t</span>*)endereco;
  
  <span class="syntax-keyword">for</span> (<span class="syntax-type">int</span> i = <span class="syntax-number">0</span>; i < tamanho; i++) {
    <span class="syntax-keyword">if</span> (i % <span class="syntax-number">8</span> == <span class="syntax-number">0</span>) {
      <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F("0x"</span>));
      <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(endereco + i, <span class="syntax-function">HEX</span>);
      <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F(": "</span>));
    }
    
    <span class="syntax-type">uint8_t</span> valor = *(ptr + i);
    <span class="syntax-keyword">if</span> (valor < <span class="syntax-number">0x10</span>) <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F("0"</span>));
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(valor, <span class="syntax-function">HEX</span>);
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F(" "</span>));
    
    <span class="syntax-keyword">if</span> ((i + <span class="syntax-number">1</span>) % <span class="syntax-number">8</span> == <span class="syntax-number">0</span>) <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>();
  }
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>();
}

<span class="syntax-type">void</span> <span class="syntax-function">cmd_reg_info</span>(<span class="syntax-type">char</span>* args[], <span class="syntax-type">int</span> argc) {
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">F("‚öôÔ∏è STATUS DOS REGISTRADORES:\n"</span>));
  
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F("DDRA  (0x"</span>));
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>((<span class="syntax-type">uint16_t</span>)&<span class="syntax-function">DDRA</span>, <span class="syntax-function">HEX</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F("): 0x"</span>));
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-function">DDRA</span>, <span class="syntax-function">HEX</span>);
  
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F("PORTA (0x"</span>));
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>((<span class="syntax-type">uint16_t</span>)&<span class="syntax-function">PORTA</span>, <span class="syntax-function">HEX</span>);
  <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F("): 0x"</span>));
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-function">PORTA</span>, <span class="syntax-function">HEX</span>);
  
  <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(F<span class="syntax-string">("\nüéØ Valor padr√£o atual: 0x"</span> + <span class="syntax-type">String</span>(valor_padrao, <span class="syntax-function">HEX</span>)));
}

<span class="syntax-type">void</span> <span class="syntax-function">cmd_debug</span>(<span class="syntax-type">char</span>* args[], <span class="syntax-type">int</span> argc) {
  <span class="syntax-keyword">if</span> (argc < <span class="syntax-number">2</span>) {
    <span class="syntax-function">Serial</span>.<span class="syntax-function">print</span>(<span class="syntax-string">F("üîç Modo debug: "</span>));
    <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(modo_debug ? <span class="syntax-string">F("ATIVO"</span>) : <span class="syntax-string">F("INATIVO"</span>));
    <span class="syntax-keyword">return</span>;
  }
  
  <span class="syntax-keyword">if</span> (<span class="syntax-function">strcmp</span>(args[<span class="syntax-number">1</span>], <span class="syntax-string">"on"</span>) == <span class="syntax-number">0</span>) {
    modo_debug = <span class="syntax-keyword">true</span>;
    <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">F("‚úÖ Modo debug ativado"</span>));
  } <span class="syntax-keyword">else if</span> (<span class="syntax-function">strcmp</span>(args[<span class="syntax-number">1</span>], <span class="syntax-string">"off"</span>) == <span class="syntax-number">0</span>) {
    modo_debug = <span class="syntax-keyword">false</span>;
    <span class="syntax-function">Serial</span>.<span class="syntax-function">println</span>(<span class="syntax-string">F("‚ùå Modo debug desativado"</span>));
  }
}

<span class="syntax-type">void</span> <span class="syntax-